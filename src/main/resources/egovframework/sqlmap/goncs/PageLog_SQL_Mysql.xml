<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="PageLogs">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="PageLogVO" type="egovframework.goncs.member.service.PageLogVO"/>
	<typeAlias  alias="PageLogVOs" type="egovframework.goncs.member.service.PageLogVO"/>

	<select id="pagelogDAO.selectPagelogList" parameterClass="PageLogVO" resultClass="PageLogVOs">
		<![CDATA[ 
			SELECT a.*, b.us_name
			FROM tb_page_log a
			LEFT OUTER JOIN member b ON b.us_id = a.m_id
			WHERE 1=1
		]]>
		<isNotEmpty property="us_name">
             AND b.us_name LIKE CONCAT ('%', #us_name#,'%')
         </isNotEmpty>
		<isNotEmpty property="strdat">
             AND DATE_FORMAT(a.reg_date,'%Y-%m-%d') BETWEEN #strdat# AND #enddat#
        </isNotEmpty>
		<![CDATA[ 
			ORDER BY a.idx desc
			LIMIT  #recordCountPerPage# OFFSET #firstIndex#
		]]>
	</select>
	
	<select id="pagelogDAO.selectPagelogListCnt" parameterClass="PageLogVO" resultClass="int">
		<![CDATA[
			SELECT COUNT(a.idx) AS totcnt
			FROM tb_mem_log a
			LEFT OUTER JOIN member b ON b.us_id = a.m_id
			WHERE 1=1
		]]>
		<isNotEmpty property="us_name">
             AND b.us_name LIKE CONCAT ('%', #us_name#,'%')
        </isNotEmpty>
		<isNotEmpty property="strdat">
             AND DATE_FORMAT(a.reg_date,'%Y-%m-%d') BETWEEN #strdat# AND #enddat#
        </isNotEmpty>
	</select>
	
	<insert id="pagelogDAO.insertPagelog">
        <![CDATA[
            INSERT INTO tb_page_log 
                (   
                    page_name   ,
                    m_id  ,
                    com_ip  ,
                    reg_date  )
              VALUES(
                    #page_name#,
                    #m_id#,
                    #com_ip#,
                    now()  )              
        ]]>
    </insert>
    
	<delete id="pagelogDAO.deletePagelog">
        <![CDATA[
            delete 
            from tb_page_log
            WHERE idx = #idx#
        ]]>
    </delete>
    
	<select id="pagelogDAO.selectPagelogListXls" parameterClass="PageLogVO" resultClass="PageLogVOs">
		<![CDATA[ 
			SELECT a.*, b.us_name
			FROM tb_page_log a
			LEFT OUTER JOIN member b ON b.us_id = a.m_id
			WHERE 1=1
		]]>
		<isNotEmpty property="us_name">
             AND b.us_name LIKE CONCAT ('%', #us_name#,'%')
         </isNotEmpty>
		<isNotEmpty property="strdat">
             AND DATE_FORMAT(a.reg_date,'%Y-%m-%d') BETWEEN #strdat# AND #enddat#
        </isNotEmpty>
		ORDER BY a.reg_date desc
	</select>
	

</sqlMap>