<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="MtSurveys">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="MtSurveyVO" type="egovframework.goncs.memto.service.MtSurveyVO"/>
	<typeAlias  alias="MtSurveyVOs" type="egovframework.goncs.memto.service.MtSurveyVO"/>
	
	<select id="mtSurveyDAO.selectMtSurveyList" resultClass="MtSurveyVOs">
	    <![CDATA[
	    	SELECT 
        		a.*, ifnull(b.us_gbn,'') us_gbn
   			FROM   tb_mento_survey a
   			left join member b on b.us_id=a.w_id and b.us_level < 5
        	WHERE 1=1
			AND a.counsel_idx = #counsel_idx#
			ORDER BY a.idx
		]]>
    </select>
    
	<select id="mtSurveyDAO.selectMtSurveyListCnt" resultClass="int">
	    <![CDATA[
	    	SELECT 
        		COUNT(a.idx) AS totcnt
   			FROM   tb_mento_survey a
   			left join member b on b.us_id=a.w_id and b.us_level < 5
        	WHERE 1=1
        	AND a.counsel_idx = #counsel_idx#
        ]]>
    </select>
    
	<select id="mtSurveyDAO.selectMtSurvey" resultClass="MtSurveyVOs">
		<![CDATA[
			SELECT a.*, ifnull(b.us_gbn,'') us_gbn, ifnull(b.us_phone,'') w_mobile
			FROM tb_mento_survey a
   			left join member b on b.us_id=a.w_id and b.us_level < 5
   			where 1=1
   			AND a.idx = #idx#
        ]]>
	</select>
	
	<select id="mtSurveyDAO.selectMtSurvey2" resultClass="MtSurveyVOs">
		<![CDATA[
			SELECT a.*, ifnull(b.us_gbn,'') us_gbn, ifnull(b.us_phone,'') w_mobile
			FROM tb_mento_survey a
   			left join member b on b.us_id=a.w_id and b.us_level < 5
   			where 1=1
   			AND a.counsel_idx = #counsel_idx#
   			order by a.idx desc
   			limit 1
        ]]>
	</select>
	
	<insert id="mtSurveyDAO.insertMtSurvey_info" parameterClass="MtSurveyVO">
        <![CDATA[
            INSERT INTO tb_mento_survey 
                  ( counsel_idx
                  , w_id
                  , w_name
                  , reg_date
                  , ans_1
                  , ans_2
                  , ans_3
                  , ans_4
                  , ans_5
                  , ans_6
                  , ans_7
                  , hpoint
                  , apoint
                  , hpoint2
                  , apoint2
                  , com_ip )
           VALUES ( #counsel_idx#
                  , #w_id#
                  , #w_name#
                  , now()
                  , #ans_1#
                  , #ans_2#
                  , #ans_3#
                  , #ans_4#
                  , #ans_5#
                  , #ans_6#
                  , #ans_7#
                  , #hpoint#
                  , #apoint#
                  , #hpoint2#
                  , #apoint2#
                  , #com_ip# )
        ]]>
    </insert>
    
	<delete id="mtSurveyDAO.deleteMtSurvey">
        <![CDATA[
            delete 
            from tb_mento_survey
            WHERE idx = #idx#
        ]]>
    </delete>
	
	
</sqlMap>	