<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="MentoComents">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="MentoComentVO" type="egovframework.goncs.memto.service.MentoComentVO"/>
	<typeAlias  alias="MentoComentVOs" type="egovframework.goncs.memto.service.MentoComentVO"/>
	
	<select id="mentoComentDAO.selectMentoComentList" resultClass="MentoComentVOs">
	    <![CDATA[
	    	SELECT 
        		a.*, ifnull(b.us_gbn,'') us_gbn
   			FROM   tb_memtocounsel_coment a
   			left join member b on b.us_id=a.w_id and b.us_level < 5
        	WHERE 1=1
			AND a.counsel_idx = #counsel_idx#
			ORDER BY a.idx
		]]>
    </select>
    
	<select id="mentoComentDAO.selectMentoComentListCnt" resultClass="int">
	    <![CDATA[
	    	SELECT 
        		COUNT(a.idx) AS totcnt
   			FROM   tb_memtocounsel_coment a
   			left join member b on b.us_id=a.w_id and b.us_level < 5
        	WHERE 1=1
        	AND a.counsel_idx = #counsel_idx#
        ]]>
    </select>
    
	<select id="mentoComentDAO.selectMentoComent" resultClass="MentoComentVOs">
		<![CDATA[
			SELECT a.*, ifnull(b.us_gbn,'') us_gbn
			FROM tb_memtocounsel_coment a
   			left join member b on b.us_id=a.w_id and b.us_level < 5
   			where 1=1
   			AND a.idx = #idx#
        ]]>
	</select>
	
	<select id="mentoComentDAO.selectMentoComent2" resultClass="MentoComentVOs">
		<![CDATA[
			SELECT a.*, ifnull(b.us_gbn,'') us_gbn
			FROM tb_memtocounsel_coment a
   			left join member b on b.us_id=a.w_id and b.us_level < 5
   			where 1=1
   			AND a.counsel_idx = #counsel_idx#
   			order by a.idx desc
   			limit 1
        ]]>
	</select>
	
	<insert id="mentoComentDAO.insertMentoComent_info" parameterClass="MentoComentVO">
        <![CDATA[
            INSERT INTO tb_memtocounsel_coment 
                  ( counsel_idx
                  , w_id
                  , w_name
                  , reg_date
                  , content1
                  , com_ip )
           VALUES ( #counsel_idx#
                  , #w_id#
                  , #w_name#
                  , now()
                  , #content1#
                  , #com_ip# )
        ]]>
    </insert>
    
	<update id="mentoComentDAO.updateMentoComent_info" parameterClass="MentoComentVO">
        <![CDATA[
            UPDATE tb_memtocounsel_coment 
               SET content1 = #content1#,
			   com_ip = #com_ip#
             WHERE idx = #idx#
        ]]>
    </update>
    
	<delete id="mentoComentDAO.deleteMentoComent">
        <![CDATA[
            delete 
            from tb_memtocounsel_coment
            WHERE idx = #idx#
        ]]>
    </delete>
	
	
</sqlMap>	